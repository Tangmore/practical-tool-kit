<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预加载&懒加载</title>
</head>
<body> 
    <!-- 预加载 -->
    <section> 
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/1.gif" />
        <img src="" class="image-item" lazyload="true" data-original="./assets/images/2.png" />
    </section>
    <!-- 懒加载 -->
    <section style="display: none;"> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
        <img src="./assets/images/default.gif" data="./assets/images/2.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/3.png" alt="">
        <img src="./assets/images/default.gif" data="./assets/images/4.png" alt=""> 
    </section>
    <script>
        //预加载
        let viewHeight = document.documentElement.clientHeight;// 可视区高度
        function lazyload() {
            var elements = document.querySelectorAll('img[data-original][lazyload]');
            Array.prototype.forEach.call(elements, function (item, index) {
                var rect;
                if (item.dataset.original === "") return;
                rect = item.getBoundingClientRect(); // 用于获得页面中某个元素的左，上，右和下分别相对浏览器视窗的位置
                if (rect.bottom >= 0 && rect.top < viewHeight) {
                    ! function () {   
                        var img = new Image();
                        img.src = item.dataset.original;
                        img.onload = function () {
                            item.src = img.src;
                        }
                        item.removeAttribute("data-original"); //移除属性，下次不再遍历
                        item.removeAttribute("lazyload");
                    }()
                }
            })
        }
        lazyload(); //刚开始还没滚动屏幕时，要先触发一次函数，初始化首页的页面图片
        document.addEventListener("scroll",lazyload);

        // 懒加载
        // let viewHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;// 可视区高度
        // function lazyLoad () {
        //     let images = document.querySelectorAll('img'); 
        //     let scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;// 滚动区的高度
        //     for (let i = 0; i < images.length; i ++) {
        //         let x = viewHeight + scrollTop - images[i].offsetTop;// 图片在可视区冒出的高度
        //         if (x > 0 && x < viewHeight+images[i].height) {// 图片在可视区内
        //             images[i].src = images[i].getAttribute('data');
        //         }
        //     }
        // }
        // lazyLoad();
        // document.addEventListener('scroll', lazyLoad); 
    </script>
</body>
</html>