### Q:è°ˆè°ˆä½ å¯¹é—­åŒ…çš„ç†è§£ï¼Ÿ

## A:

# 1. æœ¬è´¨å®šä¹‰

<!-- é—­åŒ…æ˜¯èƒ½å¤Ÿè®¿é—®å¹¶ä¿æŒå…¶å£°æ˜æ—¶æ‰€åœ¨è¯æ³•ç¯å¢ƒçš„å˜é‡çš„å‡½æ•°ï¼Œå³ä½¿è¯¥å‡½æ•°åœ¨åŸå§‹ä½œç”¨åŸŸå¤–æ‰§è¡Œã€‚é—­åŒ…ç”±å‡½æ•°åŠå…¶å…³è”çš„å¼•ç”¨ç¯å¢ƒå…±åŒç»„æˆã€‚ -->

é—­åŒ…å°±åƒå‡½æ•°çš„è®°å¿†èƒŒåŒ… ğŸ’ï¼Œå½“å†…éƒ¨å‡½æ•°è®¿é—®å¤–å±‚å˜é‡æ—¶ï¼Œä¼šæŠŠè¿™ä¸ªå˜é‡è£…è¿›è‡ªå·±çš„èƒŒåŒ…ã€‚å³ä½¿å¤–å±‚å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªèƒŒåŒ…é‡Œçš„å˜é‡ä¾ç„¶æœ‰æ•ˆ

# 2. å½¢æˆæ¡ä»¶ï¼ˆä¸‰è¦ç´ ï¼‰

ä¸¾ä¸ªä¾‹å­ ğŸï¼š

```js
function createCounter() {
  let count = 0; // å¤–å±‚ä½œç”¨åŸŸå˜é‡
  function inner() {
    count++;
    console.log(count);
  }
  return inner; // æ­£ç¡®è¿”å›å‡½æ•°å¼•ç”¨
}
const counter = createCounter(); // åˆ›å»ºé—­åŒ…
counter(); // 1
counter(); // 2

// ä½¿ç”¨ç»“æŸå...
counter = null; // è§£é™¤å¼•ç”¨å¸®åŠ©GCå›æ”¶(åƒåœ¾å›æ”¶)
```

è¿™é‡Œé—­åŒ…çš„å½¢æˆåŒ…å«ä¸¤ä¸ªå…³é”®ç‚¹ï¼š

1. **å‡½æ•°åµŒå¥—** â†’ å†…å±‚å‡½æ•°åŒ…è£¹åœ¨å¤–å±‚å‡½æ•°ä¸­ï¼ˆinner åµŒå¥—åœ¨ createCounter ä¸­ï¼‰
2. **ç¯å¢ƒå¼•ç”¨** â†’ å†…å±‚å‡½æ•°ä½¿ç”¨äº†å¤–å±‚å‡½æ•°çš„å˜é‡ï¼ˆcountï¼‰
3. **å¤–éƒ¨æš´éœ²** â†’ å†…å±‚å‡½æ•°è¢«è¿”å›/ä¼ é€’ç»™å…¶ä»–ä½œç”¨åŸŸï¼ˆé€šè¿‡ return æš´éœ²ï¼‰

# 3. ä¼˜ç‚¹

- **çŠ¶æ€ä¿æŒ** â†’ è®¡æ•°å™¨æ¡ˆä¾‹ä¸­çš„ count å€¼æŒç»­å˜åŒ–
- **ç¯å¢ƒä¿æŒ** â†’ æ¨¡å—æ¨¡å¼ä¸­çš„ç§æœ‰å˜é‡ memory æŒä¹…å­˜åœ¨

# 3. ç¼ºç‚¹

1. é—­åŒ…ä¼šå¸¸é©»å†…å­˜ï¼Œä¼šå¢å¤§å†…å­˜ä½¿ç”¨é‡ï¼Œå¯¼è‡´ä¸€å®šç¨‹åº¦ä¸Šçš„å†…å­˜æ³„éœ²ã€‚
2. åœ¨æµè§ˆå™¨ä¸­å› ä¸ºå›æ”¶æœºåˆ¶æ— æ³•å›æ”¶é—­åŒ…çš„å‡½æ•°ä»¥åŠé—­åŒ…å‡½æ•°ä¸­å‚¨å­˜çš„æ•°æ®ï¼Œä¼šä½¿æ¸¸è§ˆå™¨å ç”¨æ›´å¤šçš„æ€§èƒ½å¼€é”€

æ³¨æ„äº‹é¡¹ï¼ˆå†…å­˜/æ€§èƒ½ï¼‰ï¼š

1. åŠæ—¶è§£é™¤æ— ç”¨å¼•ç”¨ï¼ˆcounter = nullï¼‰
2. é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºé—­åŒ…ï¼ˆå°¤å…¶åœ¨ DOM æ“ä½œä¸­ï¼‰
3. ä½¿ç”¨ WeakMap ä»£æ›¿ Map è¿›è¡Œå¼±å¼•ç”¨

## å®é™…åº”ç”¨

é˜²æŠ–èŠ‚æµ
æ¨¡å—æ¨¡å¼ï¼ˆå°è£…ç§æœ‰å˜é‡ï¼‰ï¼š

```js
const calculator = (function () {
  let memory = 0; // ç§æœ‰å˜é‡

  return {
    add: function (x) {
      memory += x;
      return memory;
    },
    clear: function () {
      memory = 0;
      return "cleared";
    },
  };
})();
```

å‡½æ•°å·¥å‚ï¼ˆç”Ÿæˆä¸åŒé…ç½®å‡½æ•°ï¼‰

```js
function createMultiplier(factor) {
  return function (x) {
    return x * factor;
  };
}

const double = createMultiplier(2);
const triple = createMultiplier(3);
```

ç¼“å­˜è®°å¿†åŒ–ï¼ˆä¼˜åŒ–é‡å¤è®¡ç®—ï¼‰

```js
function memoize(fn) {
  const cache = new Map();

  return function (...args) {
    const key = JSON.stringify(args);
    if (cache.has(key)) {
      return cache.get(key);
    }
    const result = fn.apply(this, args);
    cache.set(key, result);
    return result;
  };
}
```

React Hooks åŸç†ï¼ˆé—­åŒ…åº”ç”¨ï¼‰

```js
function useState(åˆå§‹å€¼) {
  let state = åˆå§‹å€¼;

  // é—­åŒ…è®°å¿†state
  const setState = (æ–°å€¼) => {
    state = æ–°å€¼;
    // è§¦å‘é‡æ¸²æŸ“...
  };

  return [state, setState];
}
```
